<!DOCTYPE html>
<html class="dark" lang="pt-BR">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Bar Los Hermanos - Finalizar Pedido</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Bebas+Neue&family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
    <!-- Material Symbols -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <!-- Custom Styles -->
    <link rel="stylesheet" href="assets/css/styles_new.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="assets/js/supabase-client.js"></script>
    <script src="assets/js/checkout.js"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#ff3131",
                        "background-light": "#f8f7f5",
                        "background-dark": "#000000",
                        "card-dark": "#1a130c",
                    },
                    fontFamily: {
                        "display": ["Plus Jakarta Sans", "sans-serif"],
                        "title": ["Bebas Neue", "cursive"],
                        "body": ["Poppins", "sans-serif"]
                    }
                },
            },
        }

        // Lógica de Persistência da Filial
        function setBranch(branch) {
            localStorage.setItem('selected-branch', branch);
            updateBranchUI();
        }

        function updateBranchUI() {
            const selected = localStorage.getItem('selected-branch') || 'Bairro';
            const btnBairro = document.getElementById('btn-branch-bairro');
            const btnCentro = document.getElementById('btn-branch-centro');

            if (selected === 'Bairro') {
                btnBairro.classList.add('border-primary', 'bg-primary/10', 'text-primary');
                btnBairro.classList.remove('border-white/10', 'bg-card-dark', 'text-slate-400');
                btnCentro.classList.add('border-white/10', 'bg-card-dark', 'text-slate-400');
                btnCentro.classList.remove('border-primary', 'bg-primary/10', 'text-primary');
            } else {
                btnCentro.classList.add('border-primary', 'bg-primary/10', 'text-primary');
                btnCentro.classList.remove('border-white/10', 'bg-card-dark', 'text-slate-400');
                btnBairro.classList.add('border-white/10', 'bg-card-dark', 'text-slate-400');
                btnBairro.classList.remove('border-primary', 'bg-primary/10', 'text-primary');
            }
        }

        document.addEventListener('DOMContentLoaded', updateBranchUI);
    </script>
</head>
<body class="bg-background-dark text-white h-screen flex flex-col overflow-hidden">
    <header class="shrink-0 flex items-center justify-between px-4 py-4 bg-background-dark z-10 border-b border-white/5">
        <button class="flex items-center justify-center w-10 h-10 rounded-full hover:bg-white/10 transition-colors" onclick="history.back()">
            <span class="material-symbols-outlined text-white">arrow_back</span>
        </button>
        <h1 class="text-lg font-bold tracking-tight">Finalizar Pedido</h1>
        <div class="w-10"></div>
    </header>

    <main class="flex-1 overflow-y-auto no-scrollbar pb-72">
        <div class="px-4 pt-6">
            <h2 class="text-[10px] font-bold uppercase tracking-widest text-[#8e7a65] mb-3 px-1">Selecione a Filial</h2>
            <div class="grid grid-cols-2 gap-3">
                <button id="btn-branch-bairro" onclick="setBranch('Bairro')" class="flex flex-col items-center justify-center p-3 rounded-2xl border-2 transition-all">
                    <span class="text-xs font-bold">Los Bairro</span>
                    <span class="text-[10px] opacity-70">Unidade Principal</span>
                </button>
                <button id="btn-branch-centro" onclick="setBranch('Centro')" class="flex flex-col items-center justify-center p-3 rounded-2xl border transition-all">
                    <span class="text-xs font-bold">Los Centro</span>
                    <span class="text-[10px] opacity-70">Unidade Centro</span>
                </button>
            </div>
        </div>

        <div class="px-4 py-6">
            <div class="flex p-1 bg-card-dark rounded-2xl">
                <button id="btn-delivery-mode" onclick="setDeliveryMode('delivery')" class="flex-1 py-3 px-4 rounded-xl text-sm font-bold bg-primary text-white shadow-sm transition-all">
                    Entrega
                </button>
                <button id="btn-pickup-mode" onclick="setDeliveryMode('pickup')" class="flex-1 py-3 px-4 rounded-xl text-sm font-bold text-[#8e7a65] hover:bg-white/5 transition-all">
                    Retirada
                </button>
            </div>
        </div>

        <!-- Endereço (Pode ser ocultado se for retirada) -->
        <div id="address-section" class="px-4 mb-8">
            <div class="bg-card-dark rounded-2xl p-4 border border-white/5">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-primary text-xl">location_on</span>
                        <h3 class="text-sm font-bold">Endereço de Entrega</h3>
                    </div>
                    <button class="text-[10px] font-bold text-primary uppercase" onclick="window.location.href='address.html'">Alterar</button>
                </div>
                <div class="pl-7" id="address-details">
                    <p class="text-sm text-white font-medium">Rua das Flores, 123</p>
                    <p class="text-xs text-[#cbad90]">Centro - São Paulo</p>
                    <div class="mt-3 flex items-center gap-2 text-primary">
                        <span class="material-symbols-outlined text-sm">schedule</span>
                        <span class="text-xs font-bold" id="delivery-time">Prazo Estimado: 30-45 min</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="px-4 space-y-4">
            <h2 class="text-sm font-bold uppercase tracking-wider text-[#8e7a65]">Seus Itens</h2>
            <div id="cart-items-container" class="space-y-6">
                <!-- Itens injetados via JS -->
            </div>
            
            <div id="empty-cart-msg" class="hidden flex-col items-center justify-center py-10 text-center">
                <span class="material-symbols-outlined text-6xl text-white/10 mb-4">shopping_cart_off</span>
                <p class="text-white/40">Seu carrinho está vazio</p>
                <a href="orders.html" class="mt-4 text-primary font-bold">Ver cardápio</a>
            </div>
        </div>

        <!-- Forma de Pagamento -->
        <div class="px-4 mt-8">
            <h2 class="text-sm font-bold uppercase tracking-wider text-[#8e7a65] mb-4">Forma de Pagamento</h2>
            <div class="space-y-3">
                <!-- Cartão/Pix -->
                <button onclick="setPaymentMethod('online')" id="pay-online" class="w-full flex items-center justify-between p-4 bg-card-dark rounded-2xl border border-primary/20 transition-all">
                    <div class="flex items-center gap-3">
                        <span class="material-symbols-outlined text-primary">credit_card</span>
                        <span class="text-sm font-bold">Cartão ou Pix</span>
                    </div>
                    <span class="material-symbols-outlined text-primary" id="check-online">check_circle</span>
                </button>

                <!-- Dinheiro -->
                <button onclick="setPaymentMethod('cash')" id="pay-cash" class="w-full flex items-center justify-between p-4 bg-card-dark rounded-2xl border border-white/5 transition-all">
                    <div class="flex items-center gap-3">
                        <span class="material-symbols-outlined text-[#8e7a65]">payments</span>
                        <span class="text-sm font-bold text-[#8e7a65]" id="text-cash">Dinheiro (na entrega)</span>
                    </div>
                    <span class="material-symbols-outlined hidden text-primary" id="check-cash">check_circle</span>
                </button>

                <!-- Campo de Troco (Oculto inicialmente) -->
                <div id="change-container" class="hidden animate-in fade-in slide-in-from-top-2 duration-300">
                    <div class="bg-card-dark border border-white/5 rounded-2xl p-4 mt-2">
                        <label class="text-[10px] font-bold uppercase text-[#8e7a65] mb-2 block">Troco para quanto?</label>
                        <div class="relative">
                            <span class="absolute left-4 top-1/2 -translate-y-1/2 text-sm font-bold text-[#8e7a65]">R$</span>
                            <input type="number" id="cash-change" placeholder="Ex: 50,00" 
                                   class="w-full bg-black/20 border-white/10 rounded-xl py-3 pl-10 pr-4 text-sm font-bold focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="px-4 mt-8 space-y-3 pb-10">
            <div class="flex justify-between items-center text-sm">
                <span class="text-[#cbad90]">Subtotal</span>
                <span class="font-medium text-white" id="cart-subtotal">R$ 0,00</span>
            </div>
            <div class="flex justify-between items-center text-sm" id="delivery-row">
                <span class="text-[#cbad90]">Taxa de Entrega</span>
                <span class="font-medium text-white" id="taxa-entrega">R$ 0,00</span>
            </div>
            <div class="flex justify-between items-center text-sm" id="discount-row">
                <span class="text-[#cbad90]">Desconto Fidelidade (10%)</span>
                <span class="font-medium text-green-500" id="cart-discount">- R$ 0,00</span>
            </div>
        </div>
    </main>

    <div class="fixed bottom-[84px] left-0 right-0 z-40 bg-background-dark/95 backdrop-blur-md border-t border-white/5 px-4 pt-4 pb-4">
        <div class="flex justify-between items-end mb-4 px-1">
            <div>
                <p class="text-xs text-[#8e7a65] font-medium uppercase tracking-widest">Total</p>
                <p class="text-3xl font-bold text-primary" id="checkout-total">R$ 0,00</p>
            </div>
            <div class="text-right">
                <div class="flex items-center gap-1 text-green-500 mb-0.5">
                    <span class="material-symbols-outlined text-[14px]">bolt</span>
                    <p class="text-[10px] font-bold uppercase">Entrega Rápida</p>
                </div>
                <p class="text-[10px] text-[#8e7a65]">30-45 min</p>
            </div>
        </div>
        <button onclick="submitOrder()" class="w-full bg-primary hover:bg-red-700 active:scale-[0.98] transition-all text-white font-bold rounded-2xl py-5 shadow-xl shadow-red-900/30 flex justify-center items-center gap-2">
            <span>Finalizar Pedido</span>
            <span class="material-symbols-outlined" style="font-size: 20px;">check_circle</span>
        </button>
    </div>

    <!-- Global Navigation -->
    <script src="assets/js/navbar.js"></script>
    <!-- Cart Logic Integration -->
    <script src="assets/js/orders.js"></script>
</body>
</html>
