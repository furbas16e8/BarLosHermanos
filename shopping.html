<!DOCTYPE html>
<html class="dark" lang="pt-BR">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Bar Los Hermanos - Finalizar Pedido</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Bebas+Neue&family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    
    <!-- Styles -->
    <link rel="stylesheet" href="assets/css/main.css">
    
    <!-- Logic -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="assets/js/supabase-client.js"></script>
    <script src="assets/js/checkout.js"></script>
</head>
<body class="checkout-layout">
    <!-- Header -->
    <header class="cart-header">
        <button class="icon-btn" onclick="history.back()">
            <span class="material-symbols-outlined icon-btn__icon">arrow_back</span>
        </button>
        <h1 class="page-title">Finalizar Pedido</h1>
        <div class="icon-btn-placeholder"></div>
    </header>

    <!-- Content Scroller -->
    <main class="cart-container no-scrollbar">
        <!-- Branch Info (Substitui o seletor de filiais) -->
        <div class="branch-info-section">
            <h2 class="section-label">Local do Pedido</h2>
            <div class="branch-info-box">
                <span class="material-symbols-outlined branch-info__icon">store</span>
                <div class="branch-info__content">
                    <p class="branch-info__name">Você está pedindo no <strong>Los Hermanos Grã Duquesa</strong></p>
                    <p class="branch-info__address">Rua Suíça, 22</p>
                </div>
            </div>
        </div>

        <!-- Delivery Mode -->
        <div class="delivery-section">
            <div class="delivery-switch">
                <button id="btn-delivery-mode" onclick="setDeliveryMode('delivery')" class="delivery-btn delivery-btn--active">
                    <span class="material-symbols-outlined">delivery_dining</span>
                    Entrega
                </button>
                <button id="btn-pickup-mode" onclick="setDeliveryMode('pickup')" class="delivery-btn">
                    <span class="material-symbols-outlined">storefront</span>
                    Retirada
                </button>
            </div>
        </div>

        <!-- Address -->
        <div id="address-section" class="address-card">
            <div class="address-header">
                <div class="address-title-group">
                    <span class="material-symbols-outlined address-title-group__icon">location_on</span>
                    <h3 class="address-title-group__text">Endereço de Entrega</h3>
                </div>
                <button class="address-change-btn" onclick="window.location.href='perfil.html'">Alterar</button>
            </div>
            <div id="address-details" class="address-details">
                <!-- JS injeta aqui -->
                <p class="address-loading">Carregando...</p>
            </div>
        </div>

        <!-- Items -->
        <div class="cart-items-section">
            <h2 class="section-label">Seus Itens</h2>
            <div id="cart-items-container" class="cart-items-list">
                <!-- JS injeta aqui -->
            </div>
            
            <div id="empty-cart-msg" class="cart-empty hidden">
                <span class="material-symbols-outlined cart-empty__icon">shopping_cart_off</span>
                <p class="cart-empty__text">Seu carrinho está vazio</p>
                <a href="orders.html" class="cart-empty__link">Ver cardápio</a>
            </div>
        </div>

        <!-- Payment -->
        <div class="payment-section">
            <h2 class="section-label">Forma de Pagamento</h2>
            <div class="payment-list">
                <button onclick="setPaymentMethod('online')" id="pay-online" class="payment-option payment-option--selected">
                    <div class="payment-option__left">
                        <span class="material-symbols-outlined payment-option__icon payment-option__icon--primary">credit_card</span>
                        <span class="payment-option__text">Cartão ou Pix</span>
                    </div>
                    <span class="material-symbols-outlined payment-option__check" id="check-online">check_circle</span>
                </button>

                <button onclick="setPaymentMethod('cash')" id="pay-cash" class="payment-option">
                    <div class="payment-option__left">
                        <span class="material-symbols-outlined payment-option__icon payment-option__icon--cash">payments</span>
                        <span class="payment-option__text payment-option__text--cash" id="text-cash">Dinheiro (na entrega)</span>
                    </div>
                    <span class="material-symbols-outlined payment-option__check hidden" id="check-cash">check_circle</span>
                </button>

                <div id="change-container" class="change-container hidden">
                    <div class="change-input-wrapper">
                        <label class="section-label change-label">Troco para quanto?</label>
                        <div class="change-input-group">
                            <span class="change-input__prefix">R$</span>
                            <input type="number" id="cash-change" placeholder="Ex: 50,00" class="change-input">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Totals -->
        <div class="totals-section">
            <div class="totals-row">
                <span class="totals-row__label">Subtotal</span>
                <span class="totals-row__value" id="cart-subtotal">R$ 0,00</span>
            </div>
            
            <div class="totals-row hidden" id="discount-row">
                <span class="totals-row__label totals-row__label--highlight">Desconto Fidelidade (10%)</span>
                <span class="totals-row__value totals-row__value--discount" id="cart-discount">- R$ 0,00</span>
            </div>

            <div class="totals-row" id="delivery-row">
                <span class="totals-row__label">Taxa de Entrega</span>
                <span class="totals-row__value" id="taxa-entrega">R$ 0,00</span>
            </div>

            <!-- Total Highlighted -->
            <div class="total-highlight">
                <span class="total-highlight__label">Total</span>
                <div class="total-highlight__right">
                    <span class="total-highlight__value" id="checkout-total">R$ 0,00</span>
                    <div class="total-highlight__badge">
                        <span class="material-symbols-outlined total-highlight__badge-icon">bolt</span>
                        <span class="total-highlight__badge-text">Entrega Rápida</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Checkout Bar (Fixed) -->
    <div class="checkout-bar">
        <button id="btn-finish" class="btn-finish">
            <span class="btn-finish__text">Finalizar Pedido</span>
            <span class="material-symbols-outlined btn-finish__icon">check_circle</span>
        </button>
    </div>

    <!-- Global Navigation -->
    <script type="module" src="assets/js/navbar.js"></script>
    <script src="assets/js/orders.js"></script>
</body>
</html>
